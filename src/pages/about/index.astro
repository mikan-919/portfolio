---
import ContributionGraph from "@/components/sections/ContributionGraph.astro";
import InfoGrid from "@/components/sections/InfoGrid.astro";
import Section from "@/components/ui/Section.astro";
import Layout from "@/layouts/Layout.astro";

const learningData = {
    title: "LEARNING",
    subtitle: "å­¦ç¿’ä¸­ãƒ»è§¦ã£ãŸã“ã¨ãŒã‚ã‚‹",
    items: [
        "HTML / CSS",
        "JavaScript / TypeScript",
        "SolidJS / React",
        "Astro",
        "Tailwind CSS",
    ],
};

const interestsData = {
    title: "INTERESTS",
    subtitle: "èˆˆå‘³ãƒ»å¥½ããªã“ã¨",
    items: ["Web Design", "UI/UX", "Gadgets", "Gaming", "Music"],
};

const nowPlayingData = {
    title: "NOW PLAYING",
    subtitle: "æœ€è¿‘ã®è¶£å‘³",
    items: [
        {
            icon: "â™ª",
            category: "MUSIC",
            title: "Bling-Bang-Bang-Born",
            detail: "Creepy Nuts",
        },
        {
            icon: "ğŸ®",
            category: "GAME",
            title: "VALORANT",
            detail: "Rank: Silver 2",
        },
    ],
};

const timelineData = [
    {
        year: "2024",
        title: "Portfolio Renewal",
        desc: "Astroã¨Tailwind CSSã‚’ä½¿ç”¨ã—ã¦ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã‚’ãƒªãƒ‹ãƒ¥ãƒ¼ã‚¢ãƒ«ã€‚",
    },
    {
        year: "2023",
        title: "Web Development",
        desc: "æœ¬æ ¼çš„ã«Webé–‹ç™ºã®å­¦ç¿’ã‚’é–‹å§‹ã€‚Reactã‚„ãƒ¢ãƒ€ãƒ³ãªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«è§¦ã‚Œã‚‹ã€‚",
    },
    {
        year: "2022",
        title: "Hello World",
        desc: "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã«èˆˆå‘³ã‚’æŒã¡ã€HTML/CSSã®åŸºç¤ã‚’å­¦ã³å§‹ã‚ã‚‹ã€‚",
    },
];

const username = "mikan-919";
const GITHUB_TOKEN = import.meta.env.GITHUB_TOKEN;

interface ContributionDay {
    contributionCount: number;
    date: string;
}

interface Week {
    contributionDays: ContributionDay[];
}

interface ContributionCalendar {
    totalContributions: number;
    weeks: Week[];
}

interface GitHubResponse {
    data: {
        user: {
            contributionsCollection: {
                contributionCalendar: ContributionCalendar;
            };
        };
    };
}

let contributionCount = "---";
let weeks: Week[] | undefined;

if (GITHUB_TOKEN) {
    try {
        const response = await fetch("https://api.github.com/graphql", {
            method: "POST",
            headers: {
                Authorization: `Bearer ${GITHUB_TOKEN}`,
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                query: `
          query($userName:String!) {
            user(login: $userName){
              contributionsCollection {
                contributionCalendar {
                  totalContributions
                  weeks {
                    contributionDays {
                      contributionCount
                      date
                    }
                  }
                }
              }
            }
          }
        `,
                variables: {
                    userName: username,
                },
            }),
        });

        if (response.ok) {
            const json = (await response.json()) as GitHubResponse;
            const calendar =
                json.data?.user?.contributionsCollection?.contributionCalendar;
            if (calendar) {
                contributionCount = calendar.totalContributions.toString();
                weeks = calendar.weeks;
            }
        }
    } catch (e) {
        console.error("Failed to fetch contributions:", e);
    }
}
---

<Layout title="Portfoliooo | About">
    <Section class="flex">
        <div
            class="p-6 shrink-0 flex-1 flex items-center justify-center bg-black text-white text-2xl
              [clip-path:polygon(0_0,100%_0,80%_100%,0_100%)]"
        >
            <h1
                class="font-extrabold text-6xl lg:text-8xl tracking-tighter leading-none text-nowrap"
            >
                ABOUT ME
            </h1>
        </div>
        <div
            class="p-6 shrink-0 flex-1 flex items-center justify-center [clip-path:polygon(20%_0,100%_0,100%_100%,0_100%)]
              -ml-[11%]"
        >
            <h1
                class="font-extrabold w-full text-6xl lg:text-8xl text-end text-nowrap overflow-hidden tracking-tighter leading-none pr-1"
            >
                MIKAN-919
            </h1>
        </div>
    </Section>
    <Section>
        <!-- Top Section: Intro & Info -->
        <div
            class="grid grid-cols-1 md:grid-cols-[5fr_2fr] border-b-2 border-black"
        >
            <div
                class="p-6 bg-white text-black flex flex-col justify-between min-h-[50vh] overflow-hidden md:min-h-auto border-b-2 md:border-b-0 md:border-r-2 border-black"
            >
                <div class="flex flex-col gap-4">
                    <div class="border-l-16 pl-4">
                        <h1
                            class="font-extrabold font-noto-sans-jp text-nowrap text-6xl md:text-6xl tracking-tighter leading-tight"
                        >
                            æ‘˜æœã¿ã‹ã‚“
                        </h1>
                        <span class="font-mono font-medium text-sm opacity-80"
                            >ID: mikan-919</span
                        >
                    </div>
                    <p
                        class="text-base leading-relaxed opacity-90 font-medium p-4"
                    >
                        å­¦æ ¡ã®å‹‰å¼·ã®å‚ã‚‰ã€è¶£å‘³ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’å­¦ç¿’ã—ã¦ã„ã‚‹å­¦ç”Ÿã€‚
                        <br />
                        ã¾ã å§‹ã‚ãŸã°ã‹ã‚Šã§ã™ãŒã€ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦å‹•ãã‚‚ã®ã‚’ä½œã‚‹ãƒ—ãƒ­ã‚»ã‚¹ãŒå¥½ãã€‚
                        <br />
                        æœ€è¿‘ã¯ã€ãƒ¢ãƒ€ãƒ³ãªãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æŠ€è¡“ï¼ˆAstro, SolidJSãªã©ï¼‰ã«é–¢å¿ƒãŒã‚ã‚Šã€ã“ã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã‚‚ãã®å®Ÿé¨“ã®å ´ã¨ã—ã¦ä½œæˆã—ã¦ã„ã‚‹ã€‚
                        <br />
                        è¶£å‘³ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¨ã¯è¨€ã£ã¦ã„ã‚‹ãŒã€æ­£ç›´ä»–ã«å¾—æ„åˆ†é‡ãŒãªã„ã®ã§å°†æ¥ã¯ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ãªã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¦ã„ã‚‹ã€‚
                        <br />
                    </p>
                </div>

                <div class="mt-12">
                    <div class="w-full h-[2px] bg-white/30 mb-6"></div>
                    <p class="font-mono text-xs opacity-60">
                        LAST UPDATED: 2024.11.28
                    </p>
                </div>
            </div>

            <div class="p-8 shrink-0 md:p-12 flex flex-col justify-center">
                <InfoGrid
                    learning={learningData}
                    interests={interestsData}
                    nowPlaying={nowPlayingData}
                    row
                />
            </div>
        </div>

        <!-- Middle Section: GitHub & Values -->
        <div class="grid grid-cols-1 md:grid-cols-2 border-b-2 border-black">
            <div
                class="p-8 md:p-12 border-b-2 md:border-b-0 md:border-r-2 border-black bg-gray-50"
            >
                <div class="flex items-baseline justify-between mb-6">
                    <h3 class="font-black text-3xl tracking-tighter">
                        GITHUB ACTIVITY
                    </h3>
                    <div class="text-right">
                        <span class="block text-4xl font-black"
                            >{contributionCount}</span
                        >
                        <span class="text-xs font-bold opacity-60"
                            >CONTRIBUTIONS (LAST YEAR)</span
                        >
                    </div>
                </div>
                <p class="mb-6 text-sm font-bold opacity-70">
                    æ—¥ã€…ã®å­¦ç¿’ã®è¨˜éŒ²ã‚„ã€é–‹ç™ºã®é€²æ—ã¯GitHubã§è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
                </p>
                <div
                    class="w-full overflow-hidden border-2 border-black bg-white p-4 shadow-[4px_4px_0px_0px_#000]"
                >
                    <ContributionGraph weeks={weeks} />
                </div>
                <div class="mt-6 text-right">
                    <a
                        href={`https://github.com/${username}`}
                        target="_blank"
                        class="inline-block text-sm font-mono underline hover:no-underline"
                    >
                        @{username} on GitHub â†’
                    </a>
                </div>
            </div>
            <div class="p-8 md:p-12 flex flex-col justify-center">
                <h3 class="font-black text-3xl mb-6 tracking-tighter">
                    VALUES
                </h3>
                <div class="space-y-6">
                    <div>
                        <h4 class="font-bold text-xl mb-2">âš¡ï¸ Simplicity</h4>
                        <p class="text-sm leading-relaxed opacity-80">
                            è¤‡é›‘ãªã‚‚ã®ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ä¿ã¤ã“ã¨ã‚’å¿ƒãŒã‘ã¦ã„ã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ã‚‚ãƒ‡ã‚¶ã‚¤ãƒ³ã‚‚ã€å¿…è¦æœ€å°é™ã®è¦ç´ ã§æœ€å¤§ã®åŠ¹æœã‚’ç™ºæ®ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚
                        </p>
                    </div>
                    <div>
                        <h4 class="font-bold text-xl mb-2">
                            ğŸ¨ Attention to Detail
                        </h4>
                        <p class="text-sm leading-relaxed opacity-80">
                            ç´°éƒ¨ã¸ã®ã“ã ã‚ã‚ŠãŒå…¨ä½“ã®è³ªã‚’é«˜ã‚ã‚‹ã¨ä¿¡ã˜ã¦ã„ã¾ã™ã€‚ãƒ”ã‚¯ã‚»ãƒ«å˜ä½ã®èª¿æ•´ã‚„ã€ãƒã‚¤ã‚¯ãƒ­ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’å¤§åˆ‡ã«ã—ã¦ã„ã¾ã™ã€‚
                        </p>
                    </div>
                    <div>
                        <h4 class="font-bold text-xl mb-2">
                            ğŸŒ± Continuous Learning
                        </h4>
                        <p class="text-sm leading-relaxed opacity-80">
                            æŠ€è¡“ã¯å¸¸ã«é€²åŒ–ã—ã¦ã„ã¾ã™ã€‚æ–°ã—ã„ãƒ„ãƒ¼ãƒ«ã‚„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’æã‚Œãšã«è©¦ã—ã€å¸¸ã«å­¦ã³ç¶šã‘ã‚‹å§¿å‹¢ã‚’æŒã¡ç¶šã‘ã¾ã™ã€‚
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Section: Timeline -->
        <div class="p-8 md:p-12 bg-black text-white">
            <h3 class="font-black text-3xl mb-12 tracking-tighter text-center">
                TIMELINE
            </h3>
            <div
                class="max-w-3xl mx-auto border-l-2 border-white/30 pl-8 md:pl-12 py-4 space-y-12"
            >
                {
                    timelineData.map((item) => (
                        <div class="relative">
                            <div class="absolute -left-[41px] md:-left-[57px] top-1 w-5 h-5 bg-black border-2 border-white rounded-full" />
                            <span class="font-mono text-sm text-white/60 mb-1 block">
                                {item.year}
                            </span>
                            <h4 class="font-bold text-xl md:text-2xl mb-2">
                                {item.title}
                            </h4>
                            <p class="text-white/80 leading-relaxed text-sm md:text-base">
                                {item.desc}
                            </p>
                        </div>
                    ))
                }
            </div>
        </div>
    </Section>
</Layout>
