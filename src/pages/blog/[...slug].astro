---
import { Image } from "astro:assets";
import { getEntry, render } from "astro:content";
import TableOfContents from "../../components/blog/TableOfContents.astro";
import Layout from "../../layouts/Layout.astro";

const { slug } = Astro.params;
if (!slug) {
    return Astro.redirect("/blog");
}
const entry = await getEntry("articles", slug);
if (!entry) {
    return Astro.redirect("/blog");
}
const { Content, headings } = await render(entry);

const formattedDate = entry.data.publishDate.toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
});
---

<Layout title={`Portfoliooo | ${entry.data.title}`}>
    <main>
        <!-- Header Image & Title -->
        <div class="full-width-border">
            <div class="content-container relative h-128">
                {
                    entry.data.image ? (
                        <Image
                            src={entry.data.image}
                            alt={entry.data.title}
                            class="w-full h-full object-cover"
                        />
                    ) : (
                        <div class="w-full h-full bg-gray-100 flex items-center justify-center">
                            <div class="opacity-20 bg-[radial-gradient(#000_1px,transparent_1px)] bg-size-[16px_16px] w-full h-full" />
                        </div>
                    )
                }
                <div class="absolute inset-0 bg-black/30 backdrop-blur-[2px]">
                    <div
                        class="absolute bottom-0 left-0 w-full p-8 md:p-16 md:pb-8 text-white"
                    >
                        <div class="max-w-5xl space-y-2">
                            <h1
                                class="text-4xl md:text-6xl font-black leading-none"
                            >
                                {entry.data.title}
                            </h1>
                            <p class="font-mono text-xs md:text-sm opacity-90">
                                PUBLISHED ON {formattedDate}
                            </p>
                            <div class="pt-2">
                                <span
                                    class="font-mono text-sm border-t-2 border-white inline-block pt-8 md:text-base opacity-90 w-full"
                                >
                                    {entry.data.description}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="full-width-border">
            <div class="content-container grid grid-cols-[7fr_3fr]">
                <div class="flex gap-4 p-8 md:py-8 md:px-16">
                    <div class="flex flex-col items-end">
                        <h6
                            class="font-black font-mono text-4xl leading-none tracking-tight uppercase"
                        >
                            Summary
                        </h6>
                        <span class="opacity-50">Generated by AI</span>
                    </div>
                    <div class="border-l-4 border-black pl-4 leading-none">
                        <p class="text-sm md:text-base opacity-90 font-light">
                            {entry.data?.summary}
                        </p>
                    </div>
                </div>
                <div class="border-l-2 border-black p-8 md:py-8 md:px-8 h-full">
                    <h6
                        class="font-black font-mono text-4xl tracking-tight uppercase"
                    >
                        Tags
                    </h6>
                    <div class="flex gap-2">
                        {
                            entry.data.tags.map((tag) => (
                                <span class="bg-white text-black px-3 py-1 text-xs font-bold uppercase tracking-wider">
                                    #{tag}
                                </span>
                            ))
                        }
                    </div>
                </div>
            </div>
        </div>
        <!-- Content -->
        <div class="full-width-border">
            <div
                class="content-container grid grid-cols-1 lg:grid-cols-[250px_1fr]"
            >
                <!-- 左側：目次 (PCのみ表示) -->
                <aside
                    class="border-r-2 border-black bg-gray-50 hidden lg:block"
                >
                    <TableOfContents headings={headings} />
                </aside>
                <div
                    class="p-8 md:py-8 md:px-16 prose prose-neutral max-w-none
            prose-headings:font-black prose-headings:tracking-tighter prose-headings:text-black
            prose-p:text-black/80 prose-p:font-medium
            prose-a:text-black prose-a:underline prose-a:decoration-2 prose-a:underline-offset-4 hover:prose-a:bg-black hover:prose-a:text-white prose-a:transition-colors
            prose-blockquote:border-l-4 prose-blockquote:border-black prose-blockquote:bg-gray-50 prose-blockquote:py-2 prose-blockquote:px-4 prose-blockquote:not-italic
            prose-img:border-2 prose-img:border-black"
                >
                    <Content />
                </div>
            </div>
        </div>
        <!-- Back Link -->
        <div class="max-w-4xl mx-auto px-6 pb-24">
            <a
                href="/blog"
                class="inline-flex items-center gap-2 font-bold hover:underline"
            >
                <span>&larr;</span> BACK TO BLOG
            </a>
        </div>
    </main>
</Layout>
