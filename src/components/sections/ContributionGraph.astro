---
interface ContributionDay {
    contributionCount: number;
    date: string;
}

interface Week {
    contributionDays: ContributionDay[];
}

interface Props {
    weeks?: Week[];
}

const { weeks } = Astro.props;

function getColor(count: number) {
    if (count === 0) return "bg-[#ebedf0]";
    if (count <= 3) return "bg-[#9be9a8]";
    if (count <= 6) return "bg-[#40c463]";
    if (count <= 9) return "bg-[#30a14e]";
    return "bg-[#216e39]";
}

// Calculate max weeks to display based on estimated container width
// Container has p-4 (16px each side), border (2px each side)
// Each week: 10px width + 2px gap = 12px
// Estimated available widths at different breakpoints:
// - Mobile (~320px container): ~280px available → ~23 weeks
// - Tablet (~600px container): ~560px available → ~46 weeks
// - Desktop (~800px+ container): ~750px+ available → ~62 weeks
// We'll use a conservative value that works well across all sizes
const maxWeeksToShow = 30; // Shows approximately 7 months of data
const displayWeeks = weeks ? weeks.slice(-maxWeeksToShow) : undefined;
---

<div class="w-full">
    {
        displayWeeks ? (
            <div class="flex gap-[2px] justify-end">
                {displayWeeks.map((week) => (
                    <div class="flex flex-col gap-[2px]">
                        {week.contributionDays.map((day) => (
                            <div
                                class={`w-[10px] h-[10px] ${getColor(day.contributionCount)}`}
                                title={`${day.date}: ${day.contributionCount} contributions`}
                            />
                        ))}
                    </div>
                ))}
            </div>
        ) : (
            <div class="p-4 text-center border-2 border-dashed border-gray-300 text-gray-500">
                <p>No contribution data available.</p>
            </div>
        )
    }
</div>
