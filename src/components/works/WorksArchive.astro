---
import type { CollectionEntry } from "astro:content";
import WorkCard from "../WorkCard.astro";

type Props = { works: CollectionEntry<"works">[] };
const { works } = Astro.props;
const categories = [
    "All",
    ...new Set(works.map((p) => p.data.category.toUpperCase())),
];
---

<section class="full-width-border">
    <div class="content-container">
        <!-- タイトル & フィルターエリア -->
        <div class="p-8 md:p-12 border-b-2 border-black bg-gray-50">
            <div
                class="flex flex-col md:flex-row justify-between items-start md:items-end mb-8 gap-4"
            >
                <div>
                    <p
                        class="text-xs font-bold tracking-[0.3em] text-gray-500 mb-2"
                    >
                        PROJECT ARCHIVE
                    </p>
                    <h1
                        class="text-6xl md:text-8xl font-black itaric tracking-tighter leading-none"
                    >
                        WORKS.
                    </h1>
                </div>
                <div class="text-right hidden md:block">
                    <p class="font-black text-4xl">{works.length}</p>
                    <p class="text-xs font-bold text-gray-500">
                        TOTAL PROJECTS
                    </p>
                </div>
            </div>

            <!-- フィルターボタン -->
            <div
                class="flex flex-wrap gap-2 pt-4 border-t-2 border-dotted border-gray-400"
                id="filter-container"
            >
                {
                    categories.map((cat) => (
                        <button
                            data-filter={cat}
                            class={`filter-btn relative group border-2 border-black px-4 py-2 font-bold cursor-pointer text-sm transition-all duration-200 
              ${cat === "All" ? "bg-black text-white" : "bg-white text-black"}`}
                        >
                            <span>{cat}</span>
                            <span class="slide-bg-b bg-white mix-blend-difference" />
                        </button>
                    ))
                }
            </div>
        </div>

        <!-- グリッドリスト -->
        <div
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-0.5 gap-y-0.75 bg-black"
        >
            {
                works.map((work) => (
                    // data-category属性を付与して、JSでフィルタリングできるようにする
                    <div
                        class="work-item bg-white h-full"
                        data-category={work.data.category}
                    >
                        <WorkCard {...work.data} id={work.id} />
                    </div>
                ))
            }
        </div>

        <!-- 該当なしメッセージ -->
        <div
            id="no-results"
            class="hidden p-12 text-center font-bold text-gray-500"
        >
            NO PROJECTS FOUND IN THIS CATEGORY.
        </div>
    </div>
</section>

<!-- フィルタリング用スクリプト -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const buttons = document.querySelectorAll(".filter-btn");
        const items = document.querySelectorAll(".work-item");
        const noResults = document.getElementById("no-results");

        buttons.forEach((btn) => {
            btn.addEventListener("click", () => {
                const filter = btn.getAttribute("data-filter");

                // ボタンのスタイル切り替え
                buttons.forEach((b) => {
                    b.classList.remove("bg-black", "text-white");
                    b.classList.add("bg-white", "text-black");
                });
                btn.classList.remove("bg-white", "text-black");
                btn.classList.add("bg-black", "text-white");

                // アイテムの表示/非表示
                let visibleCount = 0;
                items.forEach((item) => {
                    const category = item.getAttribute("data-category");
                    if (
                        filter === "All" ||
                        category === filter?.toLowerCase()
                    ) {
                        (item as HTMLElement).style.display = "block";
                        visibleCount++;
                    } else {
                        (item as HTMLElement).style.display = "none";
                    }
                });

                // 該当なし表示
                if (noResults) {
                    noResults.style.display =
                        visibleCount === 0 ? "block" : "none";
                }
            });
        });
    });
</script>
