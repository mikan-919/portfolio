---
import type { CollectionEntry } from "astro:content";
import WorkCard from "../WorkCard.astro";

type Props = {
    works: CollectionEntry<"works">[];
    length: number;
};
const { works, length } = Astro.props;
const categories = [
    "All",
    ...new Set(works.map((p) => p.data.category.toUpperCase())),
];
---

<section class="full-width-border">
    <div class="content-container">
        <div class="p-8 border-b-2 border-black bg-gray-100">
            <div class="flex justify-between items-end">
                <div>
                    <div class="p-4 md:px-8 pb-2">
                        <h2
                            class="text-5xl tracking-tighter font-black leading-none"
                        >
                            ALL PROJECTS
                        </h2>
                    </div>
                    <div
                        class="flex flex-wrap gap-2 px-8 pb-4"
                        id="filter-container"
                    >
                        {
                            categories.map((cat) => (
                                <button
                                    data-filter={cat}
                                    class={`filter-btn relative group border-2 border-black px-4 py-2 font-bold cursor-pointer text-sm transition-all duration-200 
              ${cat === "All" ? "bg-black text-white" : "bg-white text-black"}`}
                                >
                                    <span>{cat}</span>
                                    <span class="slide-bg-b bg-white mix-blend-difference" />
                                </button>
                            ))
                        }
                    </div>
                </div><div class="text-right hidden md:block">
                    <p class="font-black text-4xl">{length}</p>
                    <p class="text-xs font-bold text-gray-500">
                        TOTAL PROJECTS
                    </p>
                </div>
            </div>
        </div>
        <div
            class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-5 gap-0.5 gap-y-0.75"
        >
            {
                works.map((work) => (
                    // data-category属性を付与して、JSでフィルタリングできるようにする
                    <div
                        class="work-item bg-white h-full"
                        data-category={work.data.category}
                    >
                        <WorkCard {...work.data} id={work.id} />
                    </div>
                ))
            }
        </div>
        <!-- 該当なしメッセージ -->
        <div
            id="no-results"
            class="hidden p-12 text-center font-bold text-gray-500"
        >
            NO PROJECTS FOUND IN THIS CATEGORY.
        </div>
    </div>
</section>

<!-- フィルタリング用スクリプト -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const buttons = document.querySelectorAll(".filter-btn");
        const items = document.querySelectorAll(".work-item");
        const noResults = document.getElementById("no-results");

        buttons.forEach((btn) => {
            btn.addEventListener("click", () => {
                const filter = btn.getAttribute("data-filter");

                // ボタンのスタイル切り替え
                buttons.forEach((b) => {
                    b.classList.remove("bg-black", "text-white");
                    b.classList.add("bg-white", "text-black");
                });
                btn.classList.remove("bg-white", "text-black");
                btn.classList.add("bg-black", "text-white");

                // アイテムの表示/非表示
                let visibleCount = 0;
                items.forEach((item) => {
                    const category = item.getAttribute("data-category");
                    if (
                        filter === "All" ||
                        category === filter?.toLowerCase()
                    ) {
                        (item as HTMLElement).style.display = "block";
                        visibleCount++;
                    } else {
                        (item as HTMLElement).style.display = "none";
                    }
                });

                // 該当なし表示
                if (noResults) {
                    noResults.style.display =
                        visibleCount === 0 ? "block" : "none";
                }
            });
        });
    });
</script>
