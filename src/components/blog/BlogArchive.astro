---
import type { CollectionEntry } from "astro:content";
import ArticleCard from "./ArticleCard.astro";

type Props = { articles: CollectionEntry<"articles">[] };
const { articles } = Astro.props;

// Extract all tags for filtering
const allTags = articles.flatMap((article) => article.data.tags);
const uniqueTags = ["All", ...new Set(allTags)];
---

<section class="full-width-border">
    <div class="content-container">
        <!-- Title & Filter Area -->
        <div class="p-8 md:p-12 border-b-2 border-black bg-gray-50">
            <div
                class="flex flex-col md:flex-row justify-between items-start md:items-end mb-8 gap-4"
            >
                <div>
                    <p
                        class="text-xs font-bold tracking-[0.3em] text-gray-500 mb-2"
                    >
                        BLOG ARCHIVE
                    </p>
                    <h1
                        class="text-6xl md:text-8xl font-black itaric tracking-tighter leading-none"
                    >
                        BLOG.
                    </h1>
                </div>
                <div class="text-right hidden md:block">
                    <p class="font-black text-4xl">{articles.length}</p>
                    <p class="text-xs font-bold text-gray-500">
                        TOTAL ARTICLES
                    </p>
                </div>
            </div>

            <!-- Filter Buttons -->
            <div
                class="flex flex-wrap gap-2 pt-4 border-t-2 border-dotted border-gray-400"
                id="filter-container"
            >
                {
                    uniqueTags.map((tag) => (
                        <button
                            data-filter={tag}
                            class={`filter-btn relative group border-2 border-black px-4 py-2 font-bold cursor-pointer text-sm transition-all duration-200 
              ${tag === "All" ? "bg-black text-white" : "bg-white text-black"}`}
                        >
                            <span>#{tag}</span>
                            <span class="slide-bg-b bg-white mix-blend-difference" />
                        </button>
                    ))
                }
            </div>
        </div>

        <!-- Grid List -->
        <div
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-0.5 gap-y-0.75 bg-black"
        >
            {
                articles.map((article) => (
                    <div
                        class="article-item bg-white h-full"
                        data-tags={JSON.stringify(article.data.tags)}
                    >
                        <ArticleCard {...article.data} slug={article.id} />
                    </div>
                ))
            }
        </div>

        <!-- No Results Message -->
        <div
            id="no-results"
            class="hidden p-12 text-center font-bold text-gray-500"
        >
            NO ARTICLES FOUND WITH THIS TAG.
        </div>
    </div>
</section>

<!-- Filtering Script -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const buttons = document.querySelectorAll(".filter-btn");
        const items = document.querySelectorAll(".article-item");
        const noResults = document.getElementById("no-results");

        buttons.forEach((btn) => {
            btn.addEventListener("click", () => {
                const filter = btn.getAttribute("data-filter");

                // Toggle button styles
                buttons.forEach((b) => {
                    b.classList.remove("bg-black", "text-white");
                    b.classList.add("bg-white", "text-black");
                });
                btn.classList.remove("bg-white", "text-black");
                btn.classList.add("bg-black", "text-white");

                // Show/Hide items
                let visibleCount = 0;
                items.forEach((item) => {
                    const tags = JSON.parse(
                        item.getAttribute("data-tags") || "[]",
                    );
                    if (filter === "All" || tags.includes(filter)) {
                        (item as HTMLElement).style.display = "block";
                        visibleCount++;
                    } else {
                        (item as HTMLElement).style.display = "none";
                    }
                });

                // Show no results message
                if (noResults) {
                    noResults.style.display =
                        visibleCount === 0 ? "block" : "none";
                }
            });
        });
    });
</script>
